<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <base target="_top">
    <title>Devoluções NFe</title>
    <?!= include('FrontendCSS'); ?>
  </head>
  <body>
    <div id="app">
      <!-- Seção de login -->
      <div id="loginSection">
        <h2>Login - Informe seu PIN</h2>
        <input id="pinInput" type="text" maxlength="6" placeholder="PIN de 6 dígitos" />
        <!-- O PIN é pré-definido na aba Users, então este botão pode ficar oculto -->
        <button id="btnGerarPin" type="button" style="display:none">Gerar Novo PIN</button>
        <button id="btnEntrar" type="button">Entrar</button>
        <div id="loginMsg"></div>
      </div>

      <!-- Menu principal -->
      <div id="menuSection" style="display:none; margin-top:20px;">
        <button data-section="upload">Upload</button>
        <button data-section="lista">Lista</button>
        <button id="btnLogout" type="button" style="float:right;">Sair</button>
      </div>

      <!-- Seção de Upload -->
      <div id="uploadSection" class="pageSection" style="display:none;">
        <h3>Enviar XML de devolução</h3>
        <p>Você pode selecionar um arquivo .xml ou colar o conteúdo (um por vez).</p>
        <input id="xmlFile" type="file" accept=".xml,text/xml" multiple style="margin:6px 0;">
        <textarea id="xmlText" rows="12" placeholder="Cole aqui o XML completo"></textarea>
        <br />
        <button id="btnUpload" type="button">Importar XML</button>
        <div id="uploadMsg" style="margin-top:10px;"></div>
      </div>

      <!-- Seção de Lista -->
      <div id="listaSection" class="pageSection" style="display:none;">
        <h3>Lista de notas</h3>
        
        <!-- Resumos no cabeçalho -->
        <div class="row cols-3" style="margin:12px 0; gap:12px;">
          <div style="background:var(--info); color:white; padding:12px; border-radius:8px; text-align:center;">
            <div style="font-size:1.5em; font-weight:bold;" id="totalNotas">-</div>
            <div>Total de Notas</div>
          </div>
          <div style="background:var(--brand); color:white; padding:12px; border-radius:8px; text-align:center;">
            <div style="font-size:1.5em; font-weight:bold;" id="pendentes">-</div>
            <div>Pendentes</div>
          </div>
          <div style="background:var(--danger); color:white; padding:12px; border-radius:8px; text-align:center;">
            <div style="font-size:1.5em; font-weight:bold;" id="recusadas">-</div>
            <div>Recusadas</div>
          </div>
        </div>
        
        <div class="row cols-3" style="margin:8px 0;">
          <label>Emitente
            <input id="fEmitente" type="text" placeholder="Nome do emitente">
          </label>
          <label>Status
            <select id="fStatus">
              <option value="">(todos)</option>
              <option>Pendente</option>
              <option>Aceita</option>
              <option>Recusada</option>
            </select>
          </label>
          <label>Emissão (início)
            <input id="fEmissaoIni" type="date">
          </label>
          <label>Emissão (fim)
            <input id="fEmissaoFim" type="date">
          </label>
        </div>
        <button id="btnAtualizarLista" type="button">Filtrar / Atualizar</button>
        <table id="listaTable"></table>
      </div>

      <!-- Seções removidas: Dashboard e Minhas Atividades -->
    </div>


<!-- Detalhe / Validação -->
<div id="detalheSection" class="pageSection" style="display:none;">
  <h3>Detalhe da Nota</h3>
  <div id="detalheInfo"></div>

  <div style="margin:10px 0;">
    <label><input type="radio" name="statusNota" value="Aceita"> Aceitar nota</label>
    <label style="margin-left:12px;"><input type="radio" name="statusNota" value="Recusada"> Recusar nota</label>
  </div>

  <div id="pagamentoBox" style="display:none;">
    <label>Forma de pagamento:
      <select id="formaPagamento">
        <option value="">Selecione</option>
        <option>Pix</option><option>Depósito</option><option>Dinheiro</option><option>Crédito</option><option>Outros</option>
      </select>
    </label>
    <label style="margin-left:8px;">Data pagamento:
      <input type="date" id="dataPagamento">
    </label>
  </div>

  <label>Observações da nota:
    <input id="obsNota" type="text" placeholder="(obrigatório se Recusada)">
  </label>

  <h4>Itens</h4>
  <table id="itensTable">
    <tr>
      <th>Seq</th><th>Código</th><th>Descrição</th><th>Qtd</th>
      <th>Status</th><th>Motivo</th><th>Qtde Devolvida</th><th>Obs</th>
    </tr>
  </table>

  <div style="margin-top:12px;">
    <button id="btnSalvarValidacao" type="button">Salvar validação</button>
    <button id="btnVoltarLista" type="button">Voltar</button>
  </div>
  <div id="detalheMsg" style="margin-top:8px;"></div>
</div>



<!-- Modal/Seção de Detalhe -->
<div id="detalheSection" class="pageSection" style="display:none;">
  <h3>Detalhe da Nota</h3>
  <div id="detalheInfo"></div>

  <!-- status da NOTA -->
  <div style="margin:10px 0;">
    <label><input type="radio" name="statusNota" value="Aceita"> Aceitar nota</label>
    <label style="margin-left:12px;"><input type="radio" name="statusNota" value="Recusada"> Recusar nota</label>
  </div>

  <!-- campos extras (só se Aceita) -->
  <div id="pagamentoBox" style="display:none;">
    <label>Forma de pagamento:
      <select id="formaPagamento">
        <option value="">Selecione</option>
        <option>Pix</option><option>Depósito</option><option>Dinheiro</option><option>Crédito</option><option>Outros</option>
      </select>
    </label>
    <label style="margin-left:8px;">Data pagamento: <input type="date" id="dataPagamento"></label>
    <br/>
  </div>

  <label>Observações da nota:
    <input id="obsNota" type="text" placeholder="(obrigatório se Recusada)">
  </label>

  <h4>Itens</h4>
  <table id="itensTable">
    <tr>
      <th>Seq</th><th>Código</th><th>Descrição</th><th>Qtd</th><th>Status</th><th>Motivo</th><th>Qtde Devolvida</th><th>Obs</th>
    </tr>
    <!-- linhas geradas via JS -->
  </table>

  <div style="margin-top:12px;">
    <button id="btnSalvarValidacao" type="button">Salvar validação</button>
    <button id="btnVoltarLista" type="button">Voltar</button>
  </div>
  <div id="detalheMsg" style="margin-top:8px;"></div>
</div>


    <?!= HtmlService.createHtmlOutputFromFile('FrontendJS').getContent(); ?>
    <?!= HtmlService.createHtmlOutputFromFile('FrontendDashJS').getContent(); ?>

  </body>
</html>
